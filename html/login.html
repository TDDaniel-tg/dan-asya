<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í–æ–π—Ç–∏</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/login.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
        integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <!-- –•–≠–î–ï–† -->
 <!-- –•–≠–î–ï–† -->
 <header class="header">
  <div class="burger" onclick="toggleMenu()">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <div class="logo">
    <img src="logo.png" alt="Frag Store" />
  </div>

  <nav class="navigation">
    <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="catalog-all.html">–ö–∞—Ç–∞–ª–æ–≥</a>
    <div class="pages-menu" id="pagesMenu">
      <a href="#">–°—Ç—Ä–∞–Ω–∏—Ü—ã</a>
      <div class="dropdown">
        <a href="about.html">–û –Ω–∞—Å</a>
        <a href="how-to-order.html">–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</a>
        <a href="delivery-pay.html">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a>
      </div>
    </div>
    <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
  </nav>

  <!-- –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∫–æ–Ω–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞ -->
  <div class="header-right">
    <div class="icons" id="login-container">
      <!-- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É "–í–æ–π—Ç–∏" -->
      <a href="login.html" class="icon login-icon">–í–æ–π—Ç–∏</a>
    </div>
    <div class="icons">
      <div class="icon search-icon" onclick="toggleSearch()">üîç</div>
      <a href="cart.html" class="icon cart-icon">üõí</a>
    </div>
  </div>

  <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
  <div class="search-bar hidden" id="searchBar">
    <input type="text" placeholder="–ü–æ–∏—Å–∫..." />
  </div>
</header>

  
<script>
  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
  function toggleMenu() {
    const burger = document.querySelector('.burger');
    const mobileNav = document.querySelector('.mobile-nav');
    burger.classList.toggle('open');
    if (mobileNav) mobileNav.classList.toggle('active');
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–º–µ–Ω—é "–°—Ç—Ä–∞–Ω–∏—Ü—ã"
  const pagesMenu = document.getElementById('pagesMenu');
  pagesMenu.addEventListener('click', (event) => {
    event.stopPropagation();
    pagesMenu.classList.toggle('open');
  });
  document.addEventListener('click', () => {
    pagesMenu.classList.remove('open');
  });

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞
  function toggleSearch() {
    const searchBar = document.getElementById('searchBar');
    searchBar.classList.toggle('hidden');
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ (—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
  function logout() {
    localStorage.removeItem('token');
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–∏—Å—Ç–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    window.location.href = '/';
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å, –∑–∞–º–µ–Ω—è–µ–º –±–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –∫–Ω–æ–ø–∫–æ–π "–í—ã–π—Ç–∏"
  document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('token');
    const loginContainer = document.getElementById('login-container');
    if (token) {
      loginContainer.innerHTML = `
        <a href="private.html" class="icon user-icon">üôç‚Äç‚ôÇÔ∏è</a>
        <button onclick="logout()" class="logout-btn">–í—ã–π—Ç–∏</button>
      `;
    }
  });
</script>

  <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div class="container">
    <h2 id="formTitle">–í—Ö–æ–¥</h2>
    <form id="authForm">
      <!-- –û–±—â–µ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ email –∏–ª–∏ username -->
      <div class="form-group">
        <label for="usernameOrEmail">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ Email:</label>
        <input type="text" id="usernameOrEmail" required />
      </div>
      <div class="form-group">
        <label for="password">–ü–∞—Ä–æ–ª—å:</label>
        <input type="password" id="password" required />
      </div>
      <!-- –ë–ª–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
      <div class="form-group" id="confirmPasswordGroup" style="display: none;">
        <label for="confirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
        <input type="password" id="confirmPassword" />
      </div>
      <button type="submit">–í–æ–π—Ç–∏</button>
    </form>
    <p class="switch" onclick="toggleForm()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</p>
  </div>

  <script>
    let isRegister = false;

    function toggleForm() {
      isRegister = !isRegister;
      document.getElementById('formTitle').innerText = isRegister ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' : '–í—Ö–æ–¥';
      document.getElementById('confirmPasswordGroup').style.display = isRegister ? 'block' : 'none';
      document.querySelector('button').innerText = isRegister ? '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' : '–í–æ–π—Ç–∏';
      document.querySelector('.switch').innerText = isRegister ? '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏' : '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
    }

    document.getElementById('authForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const usernameOrEmail = document.getElementById('usernameOrEmail').value;
      const password = document.getElementById('password').value;

      if (isRegister) {
        const confirmPassword = document.getElementById('confirmPassword').value;
        if (password !== confirmPassword) {
          alert("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!");
          return;
        }
        // –î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º username, email –∏ password.
        // –ó–¥–µ—Å—å –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è username –∏ email.
        try {
          const response = await fetch("/api/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: usernameOrEmail, email: usernameOrEmail, password })
          });
          const data = await response.json();
          if (!response.ok) {
            alert(data.message || "–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏");
          } else {
            alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.");
            toggleForm();
          }
        } catch (error) {
          alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏");
          console.error(error);
        }
      } else {
        // –î–ª—è –≤—Ö–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º usernameOrEmail –∏ password
        try {
          const response = await fetch("/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ usernameOrEmail, password })
          });
          const data = await response.json();
          if (!response.ok) {
            alert(data.message || "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞");
          } else {
            localStorage.setItem("token", data.token);
            window.location.href = "/";
          }
        } catch (error) {
          alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ");
          console.error(error);
        }
      }
    });
  </script>
</body>
</html>
