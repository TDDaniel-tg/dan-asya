<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/basket.css" />
</head>
<body>
  <!-- –•–≠–î–ï–† -->
  <header class="header">
    <div class="burger" onclick="toggleMenu()">
      <div></div>
      <div></div>
      <div></div>
    </div>

    <div class="logo">
      <img src="logo.png" alt="Frag Store" />
    </div>

    <nav class="navigation">
      <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
      <!-- –ï—Å–ª–∏ —É –≤–∞—Å —Ñ–∞–π–ª –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è catalog.html, –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Å—ã–ª–∫—É -->
      <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
      <div class="pages-menu" id="pagesMenu">
        <a href="#">–°—Ç—Ä–∞–Ω–∏—Ü—ã</a>
        <div class="dropdown">
          <a href="about.html">–û –Ω–∞—Å</a>
          <a href="how-to-order.html">–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</a>
          <a href="delivery-pay.html">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a>
        </div>
      </div>
      <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </nav>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∫–æ–Ω–æ–∫ (–≤—Ö–æ–¥/–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç, –ø–æ–∏—Å–∫, –∫–æ—Ä–∑–∏–Ω–∞) -->
    <div class="header-right">
      <div class="icons" id="login-container">
        <!-- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É "–í–æ–π—Ç–∏" -->
        <a href="login.html" class="icon login-icon">–í–æ–π—Ç–∏</a>
      </div>
      <div class="icons">
        <div class="icon search-icon" onclick="toggleSearch()">üîç</div>
        <a href="basket.html" class="icon cart-icon">üõí</a>
      </div>
    </div>

    <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
    <div class="search-bar hidden" id="searchBar">
      <input type="text" placeholder="–ü–æ–∏—Å–∫..." />
    </div>
  </header>

  <main>
    <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>
    <div id="cart-items"></div>
    <div id="total-price"></div>
    <!-- –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã -->
    <button id="clear-cart-btn">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
  </main>

  <script>
    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
    function toggleMenu() {
      const burger = document.querySelector('.burger');
      const mobileNav = document.querySelector('.mobile-nav');
      burger.classList.toggle('open');
      if (mobileNav) mobileNav.classList.toggle('active');
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–º–µ–Ω—é "–°—Ç—Ä–∞–Ω–∏—Ü—ã"
    const pagesMenu = document.getElementById('pagesMenu');
    pagesMenu.addEventListener('click', (event) => {
      event.stopPropagation();
      pagesMenu.classList.toggle('open');
    });
    document.addEventListener('click', () => {
      pagesMenu.classList.remove('open');
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞
    function toggleSearch() {
      const searchBar = document.getElementById('searchBar');
      searchBar.classList.toggle('hidden');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ (—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/';
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å, –∑–∞–º–µ–Ω—è–µ–º –±–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –∫–Ω–æ–ø–∫–æ–π "–í—ã–π—Ç–∏"
    document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      const loginContainer = document.getElementById('login-container');
      if (token) {
        loginContainer.innerHTML = `
          <a href="private.html" class="icon user-icon">üôç‚Äç‚ôÇÔ∏è</a>
          <button onclick="logout()" class="logout-btn">–í—ã–π—Ç–∏</button>
        `;
      }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã
    document.addEventListener("DOMContentLoaded", function () {
      // –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ localStorage
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const cartItemsContainer = document.getElementById("cart-items");

      // –ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      if (cart.length === 0) {
        cartItemsContainer.innerHTML = "<p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
        document.getElementById("total-price").innerHTML = "";
      } else {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
        fetch('/api/products')
          .then(response => response.json())
          .then(products => {
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Ç–µ, ID –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ
            const cartProducts = products.filter(product => cart.includes(product._id));
            if (cartProducts.length === 0) {
              cartItemsContainer.innerHTML = "<p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
              document.getElementById("total-price").innerHTML = "";
            } else {
              // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
              const cartItems = cartProducts.map(item => `
                <div class="cart-item">
                  <img src="${item.image}" alt="${item.name}">
                  <div class="cart-item-info">
                    <h2>${item.name}</h2>
                    <p>${item.description}</p>
                    <p>–¶–µ–Ω–∞: ${item.price}‚ÇΩ</p>
                  </div>
                </div>
              `).join("");
              cartItemsContainer.innerHTML = cartItems;

              // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
              const totalPrice = cartProducts.reduce((sum, item) => sum + Number(item.price), 0);
              document.getElementById("total-price").innerHTML = `<p>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${totalPrice}‚ÇΩ</p>`;
            }
          })
          .catch(error => {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:", error);
            cartItemsContainer.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>";
          });
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É"
      document.getElementById('clear-cart-btn').addEventListener('click', function () {
        localStorage.removeItem('cart');
        cartItemsContainer.innerHTML = "<p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
        document.getElementById("total-price").innerHTML = "";
      });
    });
  </script>
</body>
</html>
